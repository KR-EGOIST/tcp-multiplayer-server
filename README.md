# TCP Multiplayer Server

## π‘‹ μ†κ°

- β€netβ€™ λ¨λ“μ„ μ‚¬μ©ν• TCP μ„λ²„ κµ¬ν„
- 2D λ©€ν‹°ν”λ μ΄μ–΄ κ²μ„μ„λ²„ κµ¬ν„

## π‘©β€π’» κ°λ°μ

<table>
  <tbody>
    <tr>
      <td align="center"><a href="https://github.com/KR-EGOIST"><img src="https://avatars.githubusercontent.com/u/54177070?v=4" width="100px;" alt=""/><br /><sub><b> κ°λ°μ : μ¤μ§„νΈ </b></sub></a><br /></td>
      </tr>
  </tbody>
</table>

## β™οΈ Backend κΈ°μ  μ¤νƒ

<img src="https://img.shields.io/badge/node.js-339933?style=for-the-badge&logo=Node.js&logoColor=white">
<img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white">

```
npm install dotenv lodash long mysql2 protobufjs uuid
npm install -D nodemon prettier
```

## π“„ ν¨ν‚· κµ¬μ΅°

### [ν¨ν‚· κµ¬μ΅°](https://industrious-lasagna-717.notion.site/Node-js-5f01dba6de4646ac8f31d6d95d55cb6c?pvs=4)

## π“ƒ ERD Diagram

![Untitled](https://github.com/KR-EGOIST/tcp-multiplayer-server/assets/54177070/7130d297-d2dd-4977-a91d-20d75ccb71dc)

## β½ ν”„λ΅μ νΈ μ£Όμ” κΈ°λ¥

#### 1. **κ²μ„μ„ μ‹¤ν–‰ν•λ©΄ Device ID, IP, PORT μ κΈ°λ³Έμ •λ³΄λ¥Ό μ…λ ¥λ°›μµλ‹λ‹¤.**
  - deviceIdλ” ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„λ΅ μ „λ‹¬ν•λ” κ°’μ…λ‹λ‹¤.
    - device id λ¥Ό λΉκ°’μΌλ΅ μ ‘μ†ν•λ” κ²½μ°, ν΄λΌμ΄μ–ΈνΈμ—μ„ uuidλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    - device id λ¥Ό λ”°λ΅ μ…λ ¥λ°›μ„ μλ„ μμµλ‹λ‹¤.

  - InitialPayload μ playerId λ” μΊλ¦­ν„°μ μΆ…λ¥μ…λ‹λ‹¤. μ΄ μ—­μ‹ ν΄λΌμ΄μ–ΈνΈμ—μ„ κ²°μ •ν•΄μ„ μ„λ²„λ΅ μ „μ†΅ν•κ² λ©λ‹λ‹¤.
    - latencyλ” μµμ΄μ— 1λ²λ§ ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² λ³΄λ‚΄κ³  μμµλ‹λ‹¤.
   
```
[ProtoContract]
public class InitialPayload
{
    [ProtoMember(1, IsRequired = true)]
    public string deviceId { get; set; }

    [ProtoMember(2, IsRequired = true)]
    public uint playerId { get; set; }
    
    [ProtoMember(3, IsRequired = true)]
    public float latency { get; set; }
}
```

#### 2. **ν΄λΌμ΄μ–ΈνΈ μ£Όλ„λ΅ μ„μΉ ν¨ν‚·μ„ κµν™ν•κ² λ©λ‹λ‹¤.**
  - μ΄λ• ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² λ³΄λ‚΄λ” ν¨ν‚·μ Payload λ” LocationUpdatePayload μ„ μ‚¬μ©ν•κ² λλ©° μ„λ²„λ΅ λ¶€ν„° λ°›λ” μ •λ³΄λ” LocationUpdate μ ν•νƒλ΅ λ°›κ²λ©λ‹λ‹¤.
    - ν΄λΌμ΄μ–ΈνΈ μ£Όλ„: ν΄λΌμ΄μ–ΈνΈμ μ΄λ‹Ή ν”„λ μ„ μ(fps)μ— λ§μ¶° ν„μ¬ μ„λ²„μ μ μ €λ“¤μ— λ€ν• μ„μΉ λ™κΈ°ν™” ν¨ν‚·μ„ μ”μ²­
    - ν΄λΌμ΄μ–ΈνΈκ°€ μ”μ²­ν•λ©΄ β†’ μ„λ²„μ—μ„ μ„μΉ ν¨ν‚· μ „μ†΅

#### 3. **λΉ„μ§€λ‹μ¤ λ΅μ§**
  - **κ²μ„ μΈμ¤ν„΄μ¤ μƒμ„±**
    - κ²μ„ μΈμ¤ν„΄μ¤κ°€ μ„λ²„κ°€ κΈ°λ™λ  λ• λ™μ‹μ— μƒμ„±
    - μ–Έμ λ‚ 1κ°μ κ²μ„ μΈμ¤ν„΄μ¤κ°€ ν™μ„±ν™” μƒνƒ

  - **μ μ € μ ‘μ†**
    - μ μ € μ ‘μ†μ‹ 1λ²μ—μ„ μƒμ„±ν•΄ λ‘” κ²μ„ μΈμ¤ν„΄μ¤μ— λ“±λ΅
    - μ μ €λ” { x, y } μ μ •λ³΄λ¥Ό μ„Έν…ν•΄λ‘” ν”„λ μ„(1/30)λ³„λ΅ μ„λ²„λ΅ μ „μ†΅

  - **μ μ € μ„μΉ μ—…λ°μ΄νΈ**
    - μ„μΉ μ—…λ°μ΄νΈ ν•Έλ“¤λ¬μ—μ„ μ μ € μ„μΉλ¥Ό μ—…λ°μ΄νΈ
    - μ„μΉ μ—…λ°μ΄νΈκ°€ λλ‚¬μΌλ©΄ λ¨λ“  μ μ €μ μ„μΉ μ •λ³΄λ¥Ό μ§λ ¬ν™”ν•΄μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² Send

#### 4. **DB μ—°λ™**
  - κ°™μ€ device id λ¥Ό κ°€μ§„ μ μ €κ°€ μ¬μ ‘μ† ν–μ„ κ²½μ° λ§μ§€λ§‰ μ„μΉμ—μ„ μ¬μ ‘μ†
  - DB(MySQL)μ„ μ—°λ™ν•μ—¬ μ μ € κ²μ„ μΆ…λ£ μ‹ μ μ €μ λ§μ§€λ§‰ μ„μΉλ¥Ό μ €μ¥
    - μ μ €μ device id λ¥Ό μ‚¬μ©ν•μ—¬ μ μ € μ •λ³΄λ¥Ό μ €μ¥

#### 5. **Latency λ¥Ό μ΄μ©ν• μ¶”μΈ΅ν•­λ²•(λ°λ“ λ μ½”λ‹) μ μ©**
  - ν΄λΌμ΄μ–ΈνΈλ” λ”°λ΅ μ„μΉλ¥Ό κ³„μ‚°ν•΄ ν”λ μ΄μ–΄μ μΊλ¦­ν„°λ” λ¶€λ“λ½λ° μ›€μ§μ΄λ„λ΅ ν–μµλ‹λ‹¤.
  - μ„λ²„λ” ν”λ μ΄μ–΄ μ™Έ λ‹¤λ¥Έ μ μ €μ μ„μΉλ¥Ό κ³„μ‚°ν•΄ ν”λ μ΄μ–΄ ν™”λ©΄μ— μ„μΉ μ΄λ™μ΄ λ³΄μ΄λ„λ΅ κµ¬ν„ν–μµλ‹λ‹¤.
  - κ³„μ‚° λ°©μ‹ : (μ†λ„ * ν”„λ μ„) + (μ†λ„ * ν”„λ μ„ * λ μ΄ν„΄μ‹)
  - κ²°λ΅ μ μΌλ΅ λ μ΄ν„΄μ‹κ°€ λ†’μ„μλ΅ μƒλ€λ°©μ μ›€μ§μ„μ΄ λκ²¨λ³΄μ…λ‹λ‹¤.

#### λ‚¨μ•„μλ” λ²„κ·Έ
  - ν”λ μ΄μ–΄κ°€ μμ‹  ν™”λ©΄μ—μ„ μƒλ€λ°©μ„ λ°€λ©΄ μ•λ°€λ¦¬μ§€λ§ μƒλ€λ°© ν™”λ©΄μ—μ„λ” λ°€λ¦¬κ³  μλ” λ¬Έμ 
  - μ‹¤μ‹κ°„ μ μ €μ fpsλ¥Ό λ°›μ•„μ„ μ‹¤μ‹κ°„μΌλ΅ μ¶”μΈ΅ν•­λ²•(λ°λ“ λ μ½”λ‹)μ„ κ³„μ‚°ν• λ ¤κ³  ν–μ§€λ§ μ‹¤μ‹κ°„μΌλ΅ fpsλ¥Ό μ„λ²„μ—μ„ μ „λ‹¬λ°›λ”λ‹ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ‹¤μμ— μ ‘μ†ν• μ μ €μ μ •λ³΄κ°€ μ €μ¥λμ§€ μ•λ” λ²„κ·Έκ°€ μμ—μµλ‹λ‹¤.
    - κ·Έλμ„ κ²μ„ μΆ…λ£μ‹ μ μ €μ λ§μ§€λ§‰ μ„μΉ x, y μΆν‘ κ°’μ΄ NaN μΌλ΅ κ°’μ΄ μ „λ‹¬λΌ DBμ—μ„ μ¤λ¥κ°€ λ‚©λ‹λ‹¤.
